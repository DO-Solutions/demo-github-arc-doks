name: "Demo: Graceful Scaling (Long-Running)"

on:
  workflow_dispatch:

jobs:
  long-running:
    runs-on: [self-hosted, doks-demo]
    steps:
      - name: Start long-running job
        run: |
          echo "============================================"
          echo "  DEMO: Graceful Scaling"
          echo "============================================"
          echo ""
          echo "Job started at: $(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)"
          echo ""
          echo "This job runs for 3 minutes to demonstrate"
          echo "that active runners are NEVER terminated."
          echo ""
          echo "Unlike ECS, ARC tracks runner state via GitHub API."
          echo "Scale-down only targets idle runners."
          echo ""

      - name: Simulate work (3 minutes)
        run: |
          for i in {1..18}; do
            echo "[$(date -u +%H:%M:%S)] Still running... iteration $i/18"
            sleep 10
          done

      - name: Complete
        run: |
          echo ""
          echo "Job completed at: $(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)"
          echo ""
          echo "SUCCESS: Runner was NEVER interrupted during execution."
          echo "The runner will now terminate gracefully."
