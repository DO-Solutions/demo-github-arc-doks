name: "Demo: Burst Scaling"

on:
  workflow_dispatch:

jobs:
  burst:
    runs-on: [self-hosted, doks-demo]
    strategy:
      matrix:
        job: [1, 2, 3, 4, 5]
      fail-fast: false
    steps:
      - name: Job start
        run: |
          echo "============================================"
          echo "  DEMO: Burst Scaling - Job ${{ matrix.job }}/5"
          echo "============================================"
          echo ""
          echo "Started at: $(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)"
          echo "Running on: $(hostname)"
          echo ""
          echo "First job gets warm capacity (instant)."
          echo "Additional jobs trigger cluster autoscaler."
          echo ""

      - name: Simulate work (60-90 seconds)
        run: |
          DURATION=$((60 + RANDOM % 30))
          echo "This job will run for ~$DURATION seconds..."
          echo ""
          for i in $(seq 1 $((DURATION / 10))); do
            echo "[$(date -u +%H:%M:%S)] Job ${{ matrix.job }} working... ($((i * 10))s)"
            sleep 10
          done

      - name: Complete
        run: |
          echo ""
          echo "Job ${{ matrix.job }} completed at: $(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)"
          echo ""
          echo "SUCCESS: Job completed regardless of node it landed on."
